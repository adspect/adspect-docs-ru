# Готовые рецепты

Данная глава содержит инструкции для решения наиболее частых задач, основанные на коллективном опыте клиентов Adspect.

:::{important}
Для клоакинга вам потребуется подписка на тариф "Профессиональный" или "Персональный". Выбор тарифа зависит от требований к
надежности клоакинга и бюджета.

Тариф "Профессиональный" является нашим флагманским продуктом для клоакинга, включающим в себя весь спектр функций и
технологий Adspect. Его самым важным ноу-хау является проверка кликов по 12 нашим главным конкурентам: это гарантирует, что
**Adspect клоачит как минимум так же надежно, как все 12 конкурентов вместе взятые.**

Тариф "Персональный" является его упрощенной и урезанной версией.
:::

:::{warning}
Не пытайтесь клоачить при помощи тарифа "Антифрод"! Он не содержит необходимых для клоакинга фильтров и баз данных, так что вы лишь потеряете время, нервы и аккаунты.
:::

Все сценарии клоакинга должны удовлетворять всем [общим рекомендациям](recommendations.md).

(cloaking-google-search-gdn)=
## Клоакинг Google (поиск, GDN)

Клоакинг Google Ads является более трудной задачей, чем клоакинг большинства других рекламных платформ, и поэтому требует специальных шагов при подготовке.

1. Создайте поток и выберите "Google Ads" в качестве цели использования на первом шаге создания потока;
2. Загрузите вашу контент-страницу в папку с белой страницей, переименуйте ее в длинное случайное имя файла, укажите это имя файла в поле "Контент" в настройках потока и задайте действие ["локальный файл"](streams.md#local-file-zero-redirect) для контента;
   :::{important}
   Если вашим конечным контентом является внешняя ссылка, то используйте локально размещенный преленд с кнопкой, ведущей на эту ссылку. Так или иначе, контент в настройках потока Adspect **должен быть настроен без редиректа**.
   :::
3. Оставьте поле белой страницы пустым, укажите "без действия" в поле действия белой страницы, и далее выполните [обратную PHP-интеграцию](integration.md#reverse-php-integration) в файл белой страницы на следующем экране после сохранения потока;
4. Протестируйте ваш поток по шагам из [раздела "Порядок работы"](overview.md#workflow), чтобы убедиться в корректности его работы;
5. Удалите строку кода обратной PHP-интеграции (строка со словом `require`) из файла белой страницы, чтобы отключить клоакинг;
6. Отправьте вашу рекламную кампанию Google Ads со ссылкой на белую страницу на модерацию;
7. После одобрения кампании "прогрейте" ее на белую страницу на низком дневном бюджете в течение 7--14 дней (чем дольше, тем лучше);
8. После "прогрева" кампании добавьте строку кода обратной PHP-интеграции обратно в файл белой страницы;
9. Переведите поток в режим "Фильтр" и продолжайте открут вашей кампании.

(cloaking-google-tracking-template)=
## Клоакинг Google (шаблон отслеживания)

1. При создании потока выберите цель использования "Google Ads (шаблон отслеживания)";
2. Укажите ссылки на контент и белую страницу, выберите действие "Редирект HTTP 302" для обеих страниц;
3. Выполните [прямую PHP-интеграцию](integration.md#forward-php-integration);
4. В шаблоне отслеживания вашей кампании добавьте к ссылке [ValueTrack-параметр](https://support.google.com/google-ads/answer/6305348) `url={lpurl}`, например: `https://tracker.link/?url={lpurl}`

(cloaking-facebook)=
## Клоакинг Facebook

1. При создании потока выберите цель использования "Facebook";
2. Белую страницу **необходимо** отображать без редиректа;
3. Выполните [интеграцию любого типа](integration.md) в зависимости от ваших конкретных нужд.

(cloaking-tiktok)=
## Клоакинг TikTok

1. При создании потока выберите цель использования "TikTok";
2. **Рекомендуется** отображать контент и белую страницу без редиректа;
3. В ссылке рекламной кампании укажите все макросы TikTok Ads (`__CAMPAIGN_ID__`, `__PLACEMENT__` и т.п.);
4. Выполните [интеграцию любого типа](integration.md) в зависимости от ваших конкретных нужд.

(cloaking-microsoft-ads-bing)=
## Клоакинг Microsoft Ads (Bing)

1. При создании потока выберите цель использования "Microsoft Ads";
2. Белую страницу **необходимо** отображать без редиректа;
3. Выполните [интеграцию любого типа](integration.md) в зависимости от ваших конкретных нужд.

(cloaking-yandex)=
## Клоакинг Яндекс

1. При создании потока выберите цель использования "Яндекс";
2. Белую страницу **необходимо** отображать без редиректа;
3. Выполните [интеграцию любого типа](integration.md) в зависимости от ваших конкретных нужд.

(cloaking-x-twitter-ads)=
## Клоакинг X (Twitter Ads)

1. При создании потока выберите цель использования "X (Twitter Ads)";
2. Белую страницу **необходимо** отображать без редиректа;
3. Выполните [интеграцию любого типа](integration.md) в зависимости от ваших конкретных нужд.

(cloaking-native-ads)=
## Клоакинг нативной рекламы (Taboola, Outbrain, MGID и др.)

1. При создании потока выберите подходящую цель использования для вашего источника трафика;
2. **Рекомендуется** отображать белую страницу без редиректа;
3. Выполните [интеграцию любого типа](integration.md) в зависимости от ваших конкретных нужд.

:::{important}
Многие сети нативной рекламы полагаются на GeoEdge или подобные ему сервисы проверки качества рекламы, которые используют
продвинутых и хорошо замаскированных ботов. Поэтому важно включить
[фильтрацию по JavaScript-отпечаткам](streams.md#js-fingerprinting) в настройках потока для их обнаружения и блокировки.
:::

(cloaking-webview-apps)=
## Клоакинг WebView

Клоакинг WebView в приложениях почти ничем не отличается от обычного клоакинга.

1. При создании потока выберите цель использования "WebView";
2. Выполните [PHP-интеграцию](integration.md#php-integration);
3. В приложении откройте заклоаченную ссылку при помощи WebView.

(in-app-cloaking)=
## Клоакинг приложений

Adspect позволяет легко клоачить контент мобильных приложений, то есть показывать целевым пользователям и модераторам
разные элементы приложения (пэйволлы, цены, условия ребиллов, WebView и т.п.)

1. При создании потока выберите подходящую цель использования для вашего источника трафика: "Google Play", "App Store"
   или типовой "Apps API";
2. Выполните [прямую PHP-интеграцию](integration.md#forward-php-integration) путем размещения файла `index.php` на своем домене ---
   URL этого файла будет простым HTTP API, который отвечает `200 OK` целевым пользователям и
   `403 Forbidden` всем остальным (модераторам);
3. Внутри приложения сделайте простой HTTP-запрос `GET` на URL вашего API и производите дальнейшие действия
   в зависимости от кода ответа:
   - 200 -- пользователь целевой, можно показывать чувствительный контент;
   - любой другой код или ошибка -- считайте пользователя модератором, не показывайте чувствительный контент.

Вы можете изменить формат ответов API при помощи выбора других действий для контента и белой страницы.
Например, можно возвращать JSON-данные вместо пустого ответа 200 для целевых пользователей:

- Действие: выполнить PHP-код
- Поле страницы: `echo json_encode(['user_is_legit' => true]);`

(detecting-bot-zones)=
## Фильтрация ботовых площадок

Популярные форматы рекламы, такие как баннеры, тизеры, нативная реклама и popunder, все наводнены ботами
для накрутки кликов --- [кликфродом](https://ru.wikipedia.org/wiki/%D0%9A%D0%BB%D0%B8%D0%BA%D1%84%D1%80%D0%BE%D0%B4).
Adspect с легкостью обнаруживает их всех, позволяя вам быстро составлять черные списки фродящих
паблишеров/площадок/сайтов/спотов (далее --- "площадок"):

1. В настройках потока заполните [поле Sub ID](streams.md#sub-id), указав в нем имя параметра ссылки,
   в котором рекламная сеть будет передавать идентификатор площадки, например `subid`;
3. В рекламной кампании добавьте этот параметр к рекламной ссылке, подставив в него подходящий по смыслу
   макрос, например `subid={zoneid}` или `subid=__PLACEMENT__` (обратитесь в поддержку рекламной сети,
   чтобы получить список поддерживаемых макросов);
3. В разделе ["Статистика"](reporting.md) личного кабинета выберите разбивку воронки по Sub ID;
4. Оцените качество трафика отдельных площадок по колонке "Качество" и составьте черный список площадок,
   например, с качеством 75% и ниже (т.е. тех, где как минимум ¼ всего трафика --- боты).

Сперва занесите в блеклист фродящие площадки, а уже далее переходите к фильтрации площадок по прибыли или ROI как обычно.

(hide-traffic-source)=
## Сокрытие источника трафика

Источник трафика обычно легко обнаружить по передаваемому в каждом клике [HTTP-заголовку Referer](https://developer.mozilla.org/ru/docs/Web/HTTP/%D0%97%D0%B0%D0%B3%D0%BE%D0%BB%D0%BE%D0%B2%D0%BA%D0%B8/Referer). Если вы хотите скрыть его от получателя трафика, то добавьте следующий код в PHP-файл Adspect после тега `<head>`:

```html
<meta name="referrer" content="no-referrer">
```

:::{note}
Если вы используете JavaScript-интеграцию, то добавьте этот код в вашу белую страницу.
:::
